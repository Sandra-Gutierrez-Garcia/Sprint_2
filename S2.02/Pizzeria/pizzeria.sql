-- MySQL Script generated by MySQL Workbench
-- Tue Apr 22 12:35:07 2025
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION';

-- -----------------------------------------------------
-- Schema pizzeria
-- -----------------------------------------------------

-- -----------------------------------------------------
-- Schema pizzeria
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `pizzeria` DEFAULT CHARACTER SET utf8 ;
USE `pizzeria` ;

-- -----------------------------------------------------
-- Table `pizzeria`.`Cliente`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `pizzeria`.`Cliente` (
  `id_Cliente` INT NOT NULL AUTO_INCREMENT,
  `Nombre` VARCHAR(45) NOT NULL,
  `Apellido1` VARCHAR(45) NOT NULL,
  `Apellido2` VARCHAR(45) NOT NULL,
  `Direccion` VARCHAR(45) NOT NULL,
  `Codigo Postal` INT NOT NULL,
  `Lacolidad` VARCHAR(45) NOT NULL,
  `Provincia` VARCHAR(45) NOT NULL,
  `Telefono` INT NULL,
  PRIMARY KEY (`id_Cliente`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `pizzeria`.`Producto`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `pizzeria`.`Producto` (
  `id_Producto` INT NOT NULL,
  `Nombre` VARCHAR(45) NOT NULL,
  `descripcion` VARCHAR(200) NOT NULL,
  `imagen` VARCHAR(400) NULL,
  `precio` INT NOT NULL,
  PRIMARY KEY (`id_Producto`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `pizzeria`.`Empleado`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `pizzeria`.`Empleado` (
  `id_Empleado` INT NOT NULL,
  `Nombre` VARCHAR(80) NOT NULL,
  `apellidos` TEXT NOT NULL,
  `NIF` VARCHAR(80) NOT NULL,
  `Telefono` INT NOT NULL,
  PRIMARY KEY (`id_Empleado`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `pizzeria`.`Pedido`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `pizzeria`.`Pedido` (
  `id_Pedido` INT NOT NULL AUTO_INCREMENT,
  `id_Cliente` INT NOT NULL,
  `id_Producto` INT NOT NULL,
  `id_Empleado` INT NOT NULL,
  `Fecha_hora` DATETIME NOT NULL,
  `Tipo_entrega` VARCHAR(45) NOT NULL,
  `Cantidad` INT NOT NULL,
  `Precio` DECIMAL NOT NULL,
  INDEX `id_Cliente_idx` (`id_Cliente` ASC) VISIBLE,
  PRIMARY KEY (`id_Pedido`),
  INDEX `id_Producto_idx` (`id_Producto` ASC) VISIBLE,
  INDEX `id_Empleado_idx` (`id_Empleado` ASC) VISIBLE,
  CONSTRAINT `id_Cliente`
    FOREIGN KEY (`id_Cliente`)
    REFERENCES `pizzeria`.`Cliente` (`id_Cliente`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `id_Producto`
    FOREIGN KEY (`id_Producto`)
    REFERENCES `pizzeria`.`Producto` (`id_Producto`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `id_Empleado`
    FOREIGN KEY (`id_Empleado`)
    REFERENCES `pizzeria`.`Empleado` (`id_Empleado`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `pizzeria`.`Tienda`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `pizzeria`.`Tienda` (
  `id_Tienda` INT NOT NULL,
  `Direccion` VARCHAR(400) NOT NULL,
  ` codigo postal` INT NOT NULL,
  `localidad` VARCHAR(100) NOT NULL,
  `provencia` VARCHAR(100) NOT NULL,
  `id_Pedido` INT NOT NULL,
  PRIMARY KEY (`id_Tienda`),
  INDEX `id_pedido_idx` (`id_Pedido` ASC) VISIBLE,
  CONSTRAINT `id_pedido`
    FOREIGN KEY (`id_Pedido`)
    REFERENCES `pizzeria`.`Pedido` (`id_Pedido`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `pizzeria`.`Entrega_Domicilio`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `pizzeria`.`Entrega_Domicilio` (
  `Entrega_Domicilio` INT NOT NULL,
  `id_Pedido` INT NOT NULL,
  `id_Empleado` INT NOT NULL,
  `fecha_de_Entrega` DATETIME NOT NULL,
  PRIMARY KEY (`Entrega_Domicilio`),
  INDEX `id_pedido_idx` (`id_Pedido` ASC) VISIBLE,
  INDEX `id_Empleado_idx` (`id_Empleado` ASC) VISIBLE,
  CONSTRAINT `id_Pedido`
    FOREIGN KEY (`id_Pedido`)
    REFERENCES `pizzeria`.`Pedido` (`id_Pedido`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `id_Empleado`
    FOREIGN KEY (`id_Empleado`)
    REFERENCES `pizzeria`.`Empleado` (`id_Empleado`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- insert
INSERT INTO `pizzeria`.`Producto` (`id_Producto`, `Nombre`, `descripcion`, `imagen`, `precio`)
VALUES
(1, 'Hamburguesa', 'Hamburguesa clásica con queso', NULL, 8),
(2, 'Pizza Margarita', 'Pizza con salsa de tomate y queso mozzarella', NULL, 10),
(3, 'Refresco Cola', 'Bebida refrescante de cola', NULL, 3),
(4, 'Pizza Pepperoni', 'Pizza con queso y pepperoni', NULL, 12),
(5, 'Té Helado', 'Bebida refrescante de té', NULL, 4),
(6, 'Hamburguesa Vegetariana', 'Hamburguesa con ingredientes vegetarianos', NULL, 9);

-- Insertar datos en Cliente
INSERT INTO `pizzeria`.`Cliente` (`id_Cliente`, `Nombre`, `Apellido1`, `Apellido2`, `Direccion`, `Codigo Postal`, `Lacolidad`, `Provincia`, `Telefono`)
VALUES
(1, 'Ana', 'García', 'Martínez', 'Calle Luna 123', 08001, 'Barcelona', 'Cataluña', 612345678),
(2, 'Juan', 'Pérez', 'Sánchez', 'Calle Sol 456', 08002, 'Barcelona', 'Cataluña', 634567890),
(3, 'Sofía', 'Lopez', 'Hernández', 'Calle Estrella 789', 08003, 'Barcelona', 'Cataluña', 622334455),
(4, 'Carlos', 'Ramírez', 'Domínguez', 'Avenida Mar 101', 08004, 'Barcelona', 'Cataluña', 645667788);

-- Insertar datos en Empleado
INSERT INTO `pizzeria`.`Empleado` (`id_Empleado`, `Nombre`, `apellidos`, `NIF`, `Telefono`)
VALUES
(1, 'Luis', 'Rodríguez Gómez', '12345678A', 611234567),
(2, 'Marta', 'Fernández López', '98765432B', 622345678),
(3, 'Laura', 'Martínez Ruiz', '13579246C', 633445566),
(4, 'Pedro', 'González Ortega', '24681357D', 644556677);

-- Insertar datos en Pedido
INSERT INTO `pizzeria`.`Pedido` (`id_Pedido`, `id_Cliente`, `id_Producto`, `id_Empleado`, `Fecha_hora`, `Tipo_entrega`, `Cantidad`, `Precio`)
VALUES
(1, 1, 2, 1, '2025-04-21', 'Entrega en tienda', 2, 20.00),
(2, 2, 1, 2, '2025-04-22', 'Entrega a domicilio', 1, 8.00),
(3, 3, 4, 3, '2025-04-20', 'Entrega en tienda', 1, 12.00),
(4, 4, 3, 4, '2025-04-21', 'Entrega a domicilio', 3, 9.00);

INSERT INTO `pizzeria`.`Tienda` (`id_Tienda`, `Direccion`, ` codigo postal`, `localidad`, `provencia`, `id_Pedido`) 
VALUES 
(1, 'Plaza Mayor 12', 08001, 'Barcelona', 'Cataluña', 1), 
(2, 'Avenida Primavera 45', 08002, 'Barcelona', 'Cataluña', 2), 
(3, 'Calle Otoño 67', 08003, 'Barcelona', 'Cataluña', 3), 
(4, 'Ronda Verano 89', 08004, 'Barcelona', 'Cataluña', 4);

-- Insertar datos en Entrega_Domicilio
INSERT INTO `pizzeria`.`Entrega_Domicilio` (`Entrega_Domicilio`, `id_Pedido`, `id_Empleado`, `fecha_de_Entrega`)
VALUES
(1, 2, 2, '2025-04-22'),
(2, 4, 4, '2025-04-21'),
(3, 3, 3, '2025-04-20');

-- consultas verificacion

select pe.Id_Cliente, sum(pe.id_pedido) as Refresco from pedido pe 
left join producto pro on pe.id_producto = pro.id_producto 
where pro.nombre LIKE 'Refresco%' group by pe.id_cliente, pe.id_pedido;

select count(pe.id_Empleado) as facturacion from pedido pe
left join empleado e on pe.id_Empleado = e.id_Empleado
where e.id_Empleado= 1;

SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;
