-- MySQL Script generated by MySQL Workbench
-- Tue Apr 22 10:51:05 2025
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION';

-- -----------------------------------------------------
-- Schema cul_ampolla
-- -----------------------------------------------------

-- -----------------------------------------------------
-- Schema cul_ampolla
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `cul_ampolla` DEFAULT CHARACTER SET utf8 ;
USE `cul_ampolla` ;

-- -----------------------------------------------------
-- Table `cul_ampolla`.`Provedor`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `cul_ampolla`.`Provedor` (
  `id_Provedor` INT NOT NULL AUTO_INCREMENT,
  `NIF` VARCHAR(9) NOT NULL,
  `Nom` VARCHAR(255) NOT NULL,
  `Direccio` VARCHAR(255) NULL DEFAULT NULL,
  `Telefon` VARCHAR(20) NULL DEFAULT NULL,
  `Fax` VARCHAR(20) NULL DEFAULT NULL,
  PRIMARY KEY (`id_Provedor`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `cul_ampolla`.`Marca`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `cul_ampolla`.`Marca` (
  `id_Marca` INT NOT NULL AUTO_INCREMENT,
  `Nombre` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`id_Marca`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `cul_ampolla`.`Gafa`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `cul_ampolla`.`Gafa` (
  `id_Gafa` INT NOT NULL AUTO_INCREMENT,
  `id_Provedor` INT NOT NULL,
  `id_Marca` INT NOT NULL,
  `Graduacion_Vidrio_Derecho` DECIMAL NULL DEFAULT NULL,
  `Graduacion_Vidrio_Izquierdo` DECIMAL NULL DEFAULT NULL,
  `Tipo_Montura` ENUM('flotante', 'pasta', 'metálica') NOT NULL,
  `Color_Montura` VARCHAR(45) NULL DEFAULT NULL,
  `Color_Vidrio_Derecho` VARCHAR(45) NULL DEFAULT NULL,
  `Color_Vidre_Esquerre` VARCHAR(45) NULL DEFAULT NULL,
  `Precio` DECIMAL NOT NULL,
  PRIMARY KEY (`id_Gafa`),
  INDEX `id_Provedor_idx` (`id_Provedor` ASC) VISIBLE,
  INDEX `id_Marca_idx` (`id_Marca` ASC) VISIBLE,
  CONSTRAINT `id_Provedor`
    FOREIGN KEY (`id_Provedor`)
    REFERENCES `cul_ampolla`.`Provedor` (`id_Provedor`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `id_Marca`
    FOREIGN KEY (`id_Marca`)
    REFERENCES `cul_ampolla`.`Marca` (`id_Marca`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `cul_ampolla`.`Cliente`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `cul_ampolla`.`Cliente` (
  `id_Cliente` INT NOT NULL AUTO_INCREMENT,
  `Nombre` VARCHAR(45) NOT NULL,
  `Direcion` VARCHAR(300) NOT NULL,
  `Telefono` VARCHAR(45) NULL DEFAULT NULL,
  `Email` VARCHAR(45) NULL DEFAULT NULL,
  `Fecha_Registro` DATE NOT NULL,
  `Recomendado_Por` INT NULL DEFAULT NULL,
  PRIMARY KEY (`id_Cliente`),
  INDEX `id_Cliente_idx` (`Recomendado_Por` ASC) VISIBLE,
  CONSTRAINT `id_Cliente`
    FOREIGN KEY (`Recomendado_Por`)
    REFERENCES `cul_ampolla`.`Cliente` (`id_Cliente`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `cul_ampolla`.`Empleado`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `cul_ampolla`.`Empleado` (
  `id_Empleado` INT NOT NULL AUTO_INCREMENT,
  `NIF` INT NULL DEFAULT NULL,
  `Nombre` VARCHAR(45) NOT NULL,
  `Apellido1` VARCHAR(45) NOT NULL,
  `Apellido2` VARCHAR(45) NOT NULL,
  `Telefono` INT NULL DEFAULT NULL,
  `Correo_Electrónico` VARCHAR(300) NULL DEFAULT NULL,
  PRIMARY KEY (`id_Empleado`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `cul_ampolla`.`Venta`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `cul_ampolla`.`Venta` (
  `id_Venta` INT NOT NULL AUTO_INCREMENT,
  `id_Cliente` INT NULL DEFAULT NULL,
  `id_Empleado` INT NULL DEFAULT NULL,
  `id_gafa` INT NULL DEFAULT NULL,
  `data_de_venta` DATE NULL DEFAULT NULL,
  `Contidad` INT NULL,
  PRIMARY KEY (`id_Venta`),
  INDEX `id_Cliente_idx` (`id_Cliente` ASC) VISIBLE,
  INDEX `id_Empleado_idx` (`id_Empleado` ASC) VISIBLE,
  INDEX `id_gafa_idx` (`id_gafa` ASC) VISIBLE,
  CONSTRAINT `id_Cliente`
    FOREIGN KEY (`id_Cliente`)
    REFERENCES `cul_ampolla`.`Cliente` (`id_Cliente`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `id_Empleado`
    FOREIGN KEY (`id_Empleado`)
    REFERENCES `cul_ampolla`.`Empleado` (`id_Empleado`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `id_gafa`
    FOREIGN KEY (`id_gafa`)
    REFERENCES `cul_ampolla`.`Gafa` (`id_Gafa`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;
-- insert--
INSERT INTO Provedor VALUES
(1, 'X1234567A', 'Proveedor Óptico Central', 'Calle Principal 123, Barcelona', '931112233', '931112244'),
(2, 'Y7890123B', 'Distribuciones de Gafas SL', 'Avenida Diagonal 456, Girona', '972334455', NULL),
(3, 'Z4567890C', 'Insumos Ópticos del Sur', 'Paseo de Gracia 78, Tarragona', '977556677', '977556688');

INSERT INTO Marca VALUES
(1, 'Ray-Ban'),
(2, 'Oakley'),
(3, 'Gucci'),
(4, 'Prada');

INSERT INTO Gafa VALUES
(1, 1, 1, -1.50, -1.75, 'metálica', 'negro', 'transparente', 'transparente', 150.00),
(2, 2, 2, NULL, NULL, 'pasta', 'marrón', 'polarizado', 'polarizado', 180.50),
(3, 1, 3, +0.75, +0.50, 'flotante', 'oro', 'transparente', 'transparente', 250.75),
(4, 3, 4, -2.00, -2.25, 'pasta', 'rojo', 'gris', 'gris', 220.00),
(5, 2, 1, -0.25, -0.50, 'metálica', 'plata', 'azul', 'azul', 165.99);

INSERT INTO Cliente VALUES
(1, 'Anna Gómez', 'Calle del Carmen 10, Barcelona', '611223344', 'anna.gomez@email.com', '2024-01-15', NULL),
(2, 'Jose Pérez', 'Avenida de la Luz 25, Girona', '622334455', 'jose.perez@email.com', '2024-03-20', 1),
(3, 'Marta López', 'Plaza Mayor 5, Tarragona', '633445566', 'marta.lopez@email.com', '2024-05-10', NULL),
(4, 'Carlos Ruiz', 'Rambla Nova 18, Tarragona', '644556677', 'carlos.ruiz@email.com', '2024-07-01', 2),
(5, 'Sofía Martín', 'Gran Vía 30, Barcelona', '655667788', 'sofia.martin@email.com', '2024-09-22', 1);

INSERT INTO Empleado VALUES
(1, 12345678, 'Laura', 'Fernández', 'Sánchez', 677889900, 'laura.fernandez@optica.com'),
(2, 87654321, 'Pedro', 'Martínez', 'García', 688990011, 'pedro.martinez@optica.com'),
(3, 23456789, 'Isabel', 'Díaz', 'López', 699001122, 'isabel.diaz@optica.com');

INSERT INTO Venta VALUES
(1, 1, 1, 1, '2025-01-20', 1),
(2, 2, 2, 2, '2025-02-10', 1),
(3, 3, 1, 3, '2025-03-05', 1),
(4, 4, 3, 4, '2025-03-15', 1),
(5, 5, 2, 1, '2025-04-01', 2);

-- consultas verifaciones 
select c.nombre ,v.* from cliente c left join venta v on c.id_Cliente = v.id_Cliente  where v.id_Cliente =1;
select g.* from empleado e left join venta v on e.id_empleado = v.id_empleado left join gafa g ON v.id_gafa = g.id_gafa where e.id_empleado=3 and year(v.data_de_venta) = 2024;
select p.nom From provedor p Join gafa g on p.id_provedor =g.id_provedor  Join venta v on g.id_gafa = v.id_gafa;

SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;
